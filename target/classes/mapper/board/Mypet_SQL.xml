<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mypet">

	 <insert id="insertBoard" parameterType="hashmap" useGeneratedKeys="true" keyProperty="BOARD_NO">
	 	<selectKey keyProperty="BOARD_NO" resultType="string" order="BEFORE">
	 		SELECT MYPET_SEQ.NEXTVAL FROM DUAL
	 	</selectKey>
		<![CDATA[  
			INSERT INTO MYPET (
				BOARD_NO,
				MYPET_SUBJECT,
				ID,
				MYPET_WRITER,
				MYPET_CONTENT,
				MYPET_DATE,
				MYPET_HEADER
			)
			VALUES (
				#{BOARD_NO},
				#{MYPET_SUBJECT},
				#{ID},
				#{MYPET_WRITER},
				#{MYPET_CONTENT},
				SYSDATE,
				#{MYPET_HEADER}
			)
		]]>
	</insert> <!-- 게시판에서는 회원 펫시터 아이디를 ID로 쓰기 때문에 변경합니다 values에 '테스트1'을 #{ID}로 변경해주세요 -->
	
   <select id="selectMemInfo" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				ID,
				PASSWORD1,
				NAME,
				PHONE,
				EMAIL,
				SEX,
				BIRTHDAY,
				ZIPCODE,
				ADDRESS1,
				ADDRESS2,
				ADDRESS_ADD,
				USE_TIME,
				JOIN_DATE,
				MEMBER_DIVISION
			FROM
				(SELECT 
					MEM_ID AS ID,
					PASSWORD1,
					NAME,
					PHONE,
					EMAIL,
					SEX,
					BIRTHDAY,
					ZIPCODE,
					ADDRESS1,
					ADDRESS2,
					ADDRESS_ADD,
					USE_TIME,
					JOIN_DATE,
					MEMBER_DIVISION
				ROM
					MEMBER
    
					UNION ALL

				SELECT
					PSMEM_ID AS ID,
					PASSWORD1,
					NAME,
					PHONE,
					EMAIL,
					SEX,
					BIRTHDAY,
					ZIPCODE,
					ADDRESS1,
					ADDRESS2,
					ADDRESS_ADD,
					USE_TIME,
					JOIN_DATE,
					MEMBER_DIVISION
				FROM
					PETSITTER
			   	)
			WHERE ID = #{ID}
		]]>
	</select>
   
   <insert id="insertFile" parameterType="hashmap">
      <![CDATA[
        INSERT INTO BOARD_FILE (
         		BOARD_TYPE,
       			BOARD_NO,
       			BOARD_FILE_NO,
                BOARD_ORIGINAL_FILE_NAME,
         		BOARD_STORED_FILE_NAME,
       			BOARD_FILE_SIZE,
       			BOARD_DATE,
       			BOARD_CREA_ID	
         )
         VALUES (
         		'MYPET',
        		#{BOARD_NO},
            	BOARD_FILE_SEQ.NEXTVAL,
                #{BOARD_ORIGINAL_FILE_NAME},
         		#{BOARD_STORED_FILE_NAME},
            	#{BOARD_FILE_SIZE},
            	sysdate,
            	'작성자'
         )
      ]]>
   </insert>
   
   <!-- <update id="mypetThumbnail" parameterType="hashmap">
   		<![CDATA[
   			UPDATE SG_GOODS SET
				MAIN_IMG = #{MAIN_IMG}
			WHERE
				BOARD_NO = #{BOARD_NO}
   		]]>
   		
   </update> -->
   
	<!-- MYPET 글 조회수 증가 -->
	<update id="updateHitCnt" parameterType="hashMap">
		<![CDATA[
			UPDATE
				MYPET
			SET
				MYPET_COUNT = NVL(MYPET_COUNT, 0) + 1
			WHERE
				BOARD_NO = #{BOARD_NO}
		]]>
	</update>
	
	<!-- 글 상세보기 -->
	<select id="selectBoardDetail" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
				SELECT
					BOARD_NO,
					MYPET_SUBJECT,
					ID,
					MYPET_WRITER,
					MYPET_CONTENT,
					MYPET_DATE,
					MYPET_COUNT,
					MYPET_HEADER
					
				FROM
					MYPET
				WHERE BOARD_NO = #{BOARD_NO}
		]]>
	</select><!-- 여기도 위와 마찬가지 -->
	
	<!-- 글 수정 -->
	<update id="updateBoard" parameterType="hashMap">
		<![CDATA[
			UPDATE MYPET
			SET
				MYPET_SUBJECT = #{MYPET_SUBJECT},
				MYPET_CONTENT = #{MYPET_CONTENT},
				MYPET_HEADER = #{MYPET_HEADER}
			WHERE
				BOARD_NO = #{BOARD_NO}
		]]>
	</update>	

	<delete id="deleteBoard" parameterType="hashmap"> 
		<![CDATA[
			DELETE
				MYPET
			WHERE
				BOARD_NO = #{BOARD_NO}
		]]>
	</delete>


	<!-- 리스트 보기 -->
	<select id="selectBoardList" parameterType="hashmap" resultType="hashmap">
		 
		<![CDATA[
			SELECT
			M.BOARD_NO, M.MYPET_SUBJECT, M.ID, M.MYPET_WRITER,
			M.MYPET_CONTENT, M.MYPET_DATE, M.MYPET_COUNT, M.MYPET_HEADER,
			F.BOARD_FILE_NO, F.BOARD_ORIGINAL_FILE_NAME, F.BOARD_STORED_FILE_NAME, F.FILE_DEL
			FROM MYPET M INNER JOIN BOARD_FILE F
			ON M.BOARD_NO = F.BOARD_NO
			WHERE F.FILE_DEL= 'N'
			ORDER BY M.BOARD_NO DESC
		]]>
		 
	</select>  

	<select id="selectFileList" parameterType="hashmap" resultType="hashmap">
	      <![CDATA[
	         SELECT
	              BOARD_FILE_NO,
	              BOARD_ORIGINAL_FILE_NAME,
	              BOARD_STORED_FILE_NAME
	         FROM
	              BOARD_FILE
	         WHERE
	              BOARD_NO = #{BOARD_NO} AND FILE_DEL = 'N'
	      ]]>
	</select>	
   
	<select id="selectCmtList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				MYPET_COMMENT_NO,
				MYPET_COMMENT_CONTENT,
				ID,
				MYPET_COMMENT_WRITER,
				MYPET_COMMENT_DATE
				
			FROM
				MYPET_COMMENT
				
			WHERE
				BOARD_NO = #{BOARD_NO}
				ORDER BY MYPET_COMMENT_NO ASC
		]]>
	</select>

	<insert id="insertComment" parameterType="hashmap">
		<![CDATA[
			INSERT INTO MYPET_COMMENT (
					BOARD_NO,
					MYPET_COMMENT_NO,
					ID,
					MYPET_COMMENT_WRITER,
					MYPET_COMMENT_CONTENT,
					MYPET_COMMENT_DATE,
					MYPET_RE_COMMENT_NO
				)
				VALUES (
					#{BOARD_NO},
					MYPET_COMMENT_SEQ.NEXTVAL,
					#{ID},
					#{MYPET_COMMENT_WRITER},
					#{MYPET_COMMENT_CONTENT},
					SYSDATE,
					MYPET_COMMENT_SEQ.NEXTVAL
				)
		 ]]>
	</insert> 
	
	<delete id="deleteComment" parameterType="hashmap"> <!-- 댓글 삭제 -->
		<![CDATA[
			DELETE 
				MYPET_COMMENT
			WHERE
				MYPET_COMMENT_NO = #{MYPET_COMMENT_NO}
		]]>
	</delete>

	<update id="deleteFile" parameterType="hashmap">
		<![CDATA[
			UPDATE BOARD_FILE
			SET 
				FILE_DEL = 'Y' 
			WHERE 
				BOARD_NO = #{BOARD_NO}
		]]>
	</update>

	<update id="updateFile" parameterType="hashmap">
		<![CDATA[
			UPDATE BOARD_FILE 
			SET
				FILE_DEL = 'N'
			WHERE
				BOARD_FILE_NO = #{BOARD_FILE_NO}	
		]]>
	</update>

</mapper>